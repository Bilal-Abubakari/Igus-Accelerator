<div class="full-screen-modal">
  <app-reusable-button
    className="close-btn"
    [isIconButton]="true"
    (buttonClick)="closeDialog()"
  >
    <mat-icon>close</mat-icon>
  </app-reusable-button>

  @if (featureFlagService.isFeatureEnabled('contactForm')) {
    <div class="form-wrapper">
      <h1 class="contact">Contact</h1>

      <p class="intro">
        Please enter your questions or suggestions. The data you enter into the
        designer will be transmitted automatically.
      </p>

      <form [formGroup]="contactForm" (ngSubmit)="submitForm()">
        <div class="name-fields-container">
          <app-reusable-form-field
            [control]="$any(contactForm.get('firstName'))"
            label="First name"
            [optional]="true"
            [errorMessages]="errorMessages"
            [flexValue]="'1'"
          ></app-reusable-form-field>

          <app-reusable-form-field
            [control]="$any(contactForm.get('lastName'))"
            label="Last name"
            [errorMessages]="errorMessages"
            [flexValue]="'1'"
          ></app-reusable-form-field>
        </div>

        <div class="email-company-container">
          <app-reusable-form-field
            [control]="$any(contactForm.get('email'))"
            label="E-mail"
            [errorMessages]="errorMessages"
          ></app-reusable-form-field>

          <app-reusable-form-field
            [control]="$any(contactForm.get('company'))"
            label="Company"
            [errorMessages]="errorMessages"
          ></app-reusable-form-field>
        </div>

        <div class="postal-country-container">
          <app-reusable-form-field
            [control]="$any(contactForm.get('postalCode'))"
            label="Postal code"
            className="postal-code"
            [flexValue]="'1'"
            [errorMessages]="errorMessages"
          ></app-reusable-form-field>

          <app-reusable-form-field
            [control]="$any(contactForm.get('country'))"
            label="Country"
            className="country"
            [flexValue]="'2'"
            [isSelect]="true"
            [selectOptions]="(countryOptions$ | async) || []"
            [errorMessages]="errorMessages"
          ></app-reusable-form-field>
        </div>

        <app-reusable-form-field
          [control]="$any(contactForm.get('telephone'))"
          label="Telephone"
          [optional]="true"
          className="telephone"
          [errorMessages]="errorMessages"
        ></app-reusable-form-field>

        <app-reusable-form-field
          [control]="$any(contactForm.get('message'))"
          label="Message"
          [optional]="true"
          [isTextarea]="true"
          [errorMessages]="errorMessages"
        ></app-reusable-form-field>

        <p class="attach-file-title">File attachment (optional)</p>

        <div class="upload-container">
          <input
            #fileInput
            type="file"
            hidden
            accept="image/jpeg,image/png,application/pdf"
            (change)="handleFileSelection($event)"
          />

          <app-reusable-button
            className="select-file-btn"
            [color]="'primary'"
            (buttonClick)="fileInput.click()"
          >
            <mat-icon>upload_file</mat-icon>
            Select File
          </app-reusable-button>

          @if (contactForm.get('file')?.value) {
            <p class="selected-file-name">
              {{ contactForm.get('file')?.value?.name }}
              <app-reusable-button
                className="delete-file-btn"
                (buttonClick)="deleteFile()"
              >
                <mat-icon>delete</mat-icon>
              </app-reusable-button>
            </p>
          }

          @if (fileValidationError) {
            <p class="error-message">
              {{ fileValidationError }}
            </p>
          }
        </div>

        <div class="terms-agreement">
          <mat-checkbox
            class="agreement"
            formControlName="agreement"
          ></mat-checkbox>

          <p class="agreement">
            I have read and understood the
            <a href="" target="_blank">data protection regulations</a> of igusÂ®
            GmbH.
          </p>
        </div>

        @if (
          contactForm.get('agreement')?.touched &&
          contactForm.get('agreement')?.hasError('required')
        ) {
          <p class="terms-error">
            {{ errorMessages.requiredTrue }}
          </p>
        }

        <div class="form-btns">
          <app-reusable-button
            className="cancel-btn"
            (buttonClick)="closeDialog()"
          >
            Cancel
          </app-reusable-button>

          <app-reusable-button
            className="submit-btn"
            type="submit"
            [disabled]="!!(isSubmitting$ | async)"
          >
            @if (isSubmitting$ | async) {
              Submitting...
            } @else {
              Submit
            }
          </app-reusable-button>
        </div>
      </form>
    </div>
  } @else {
    <div class="form-wrapper">
      <h1 class="contact">Contact</h1>

      <p class="intro">
        Our contact form is currently undergoing maintenance. Please try again
        later.
      </p>
    </div>
  }
</div>
