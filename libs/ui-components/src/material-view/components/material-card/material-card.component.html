@if (loading()) {
  <mat-progress-spinner mode="indeterminate"></mat-progress-spinner>
} @else {
  <div class="material-grid">
    @if (selectedMaterials().length > 0) {
      @for (material of selectedMaterials(); track material.id) {
        <mat-card
          class="material-card"
          [ngStyle]="{ 'border-color': material.colorhex }"
          (click)="toggleSelection(material.id)"
          (keydown.enter)="toggleSelection(material.id)"
          tabindex="0"
        >
          <div
            class="material-header"
            [ngStyle]="{ 'background-color': material.colorhex }"
          >
            @if (material.isSelected) {
              <mat-icon>check</mat-icon>
            }
          </div>

          <mat-card-header>
            <mat-card-title class="material-title">
              {{ material.name }}
            </mat-card-title>
            <mat-card-subtitle class="material-availability">
              Upon request
            </mat-card-subtitle>
          </mat-card-header>

          <mat-card-content>
            <p class="material-description">
              {{ material.description }}
            </p>

            <div class="tolerance-container">
              <label for="tolerance-{{ material.id }}">Tolerance:</label>
              <mat-progress-bar
                id="tolerance-{{ material.id }}"
                mode="determinate"
                [value]="material.tolerancePercentage"
              ></mat-progress-bar>
              <p class="tolerance-value">
                Â± {{ material.shrinkage | tolerancePercentage }}
              </p>
            </div>
          </mat-card-content>

          <mat-card-actions>
            <button
              type="button"
              mat-button
              color="primary"
              (click)="showMoreInfo(material, $event)"
            >
              More information
            </button>
          </mat-card-actions>
        </mat-card>
      }
    } @else {
      <p>No materials available.</p>
    }
  </div>
}
